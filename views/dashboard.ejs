<%- include('partials/header', { title: 'Dashboard' }) %>

<div class="card">
  <h2>Wallet: $<%= wallet.toFixed(2) %></h2>
  <p>Total spent: $<%= totalSpent.toFixed(2) %> • Total won: $<%= totalWon.toFixed(2) %></p>
</div>

<div class="games-grid">
  <% ['poker','blackjack','roulette','ride-the-bus'].forEach(game => { 
    const t = totals[game] || {spent:0,won:0};
  %>
    <div class="card game-card">
      <h3><%= game.replace('-', ' ').toUpperCase() %></h3>
      <p>Spent: $<%= t.spent.toFixed(2) %> • Won: $<%= t.won.toFixed(2) %></p>

      <form action="/bet" method="POST" class="inline-form">
        <input type="hidden" name="game" value="<%= game %>">
        <label>Bet amount
          <input name="amount" type="number" step="0.01" min="0.01" required>
        </label>
        <button type="submit">Place Bet</button>
      </form>

      <form action="/win" method="POST" class="inline-form">
        <input type="hidden" name="game" value="<%= game %>">
        <label>Win amount
          <input name="amount" type="number" step="0.01" min="0.01" required>
        </label>
        <button type="submit">I won</button>
      </form>
    </div>
  <% }) %>
</div>

<div class="card">
  <h3>Recent history</h3>
  <% if (history.length === 0) { %>
    <p>No actions yet.</p>
  <% } else { %>
    <table class="history-table">
      <thead><tr><th>Date</th><th>Game</th><th>Type</th><th>Amount</th></tr></thead>
      <tbody>
        <% history.forEach(h => { %>
          <tr>
            <td><%= new Date(h.date).toLocaleString() %></td>
            <td><%= h.game %></td>
            <td><%= h.type %></td>
            <td><%= h.type === 'bet' ? '-' : '' %>$<%= h.amount.toFixed(2) %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } %>
</div>

<%- include('partials/footer') %>
